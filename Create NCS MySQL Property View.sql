-- Creates property database view via a linked server to the NCS MySQL database (Need to setup linked server connection in SQL server first)
USE [GIS_Vector_Core]
GO
create view vwProperty as SELECT * FROM OPENQUERY(NCS ,
'select ra_properties.valuation_id AS Valuation_ID, rg_property_records.upi_id AS Parcel_ID, ra_properties.ra_unique_id AS Property_Number, ra_people.ratepayer_name_1 AS Ratepayer_Name1, ra_people.ratepayer_name_2 AS Ratepayer_Name2, ra_people.ratepayer_address_1 AS Ratepayer_Address1, ra_people.ratepayer_address_2 AS Ratepayer_Address2, ra_people.ratepayer_address_3 AS Ratepayer_Address3, ra_people.ratepayer_address_4 AS Ratepayer_Address4, ra_people.owner_name_1 AS Owner_Name1, ra_people.owner_name_2 AS Owner_Name2, ra_people.owner_address_1 AS Owner_Address1, ra_people.owner_address_2 AS Owner_Address2, ra_people.owner_address_3 AS Owner_Address3, ra_people.letter_name_1 AS Letter_Name1, ra_people.letter_name_2 AS Letter_Name2, ra_properties.improvements AS Improvements, ra_properties.certificate_of_title AS Certificate_Of_Title, ra_properties.legal_description AS Legal, ra_properties.house_no AS House_No, ra_streets.address_1 AS Address_1, ra_streets.address_2 AS Address_2,  ra_valuations.land_value AS Land_Value, ra_valuations.capital_value AS Capital_Value, ra_valuations.capital_value-ra_valuations.land_value AS Improvements_Value, ra_valuations.hectares AS Hectares, ra_valuations.last_sale_price AS Last_Sale_Price, CAST(ra_valuations.last_sale_date AS CHAR) AS Last_Sale_Date, ra_financials.total_rates_for_this_year AS Total_Rates_For_This_Year, (ra_financials.total_rates_for_this_year*3)/23 AS GST_on_This_Year_Rate, ra_valuations.new_capital_value-ra_valuations.new_land_value AS New_Improvements_Value, ra_properties.new_legal_description AS NLegal, ra_valuations.new_land_value AS New_Land_Value, ra_valuations.new_capital_value AS New_Capital_Value, ra_properties.new_improvements AS New_Improvements, ra_valuations.new_hectares AS New_Hectares                                            

FROM rg_property_records RIGHT JOIN ((ra_valuations RIGHT JOIN ((ra_properties LEFT JOIN ra_financials ON ra_properties.ra_unique_id = ra_financials.ra_unique_id) INNER JOIN ra_streets ON ra_properties.street_id = ra_streets.street_id) ON ra_valuations.ra_unique_id = ra_properties.ra_unique_id) INNER JOIN ra_people ON ra_properties.ra_unique_id = ra_people.ra_unique_id) ON rg_property_records.ra_unique_id = ra_properties.ra_unique_id');
GO
